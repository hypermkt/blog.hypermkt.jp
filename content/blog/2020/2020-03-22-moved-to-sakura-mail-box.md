---
title: 独自ドメインのメールアドレス管理をさくらのメールボックスに移設した
date: 2020-03-22
---

## はじめに

とあるサービスのメールアドレスをDovecot + Postfixで構築されたメールサーバーで管理していました。このメールサーバーは[2015年に構築](/2015/2015-11-29-server-relocated-for-ten-million-pv-site/)以来、今日まで大きな障害は一切なく安定稼働を続けてきました。しかし、OSのサポート期限が近づいてきたこともあり、OSのアップデート対応をする必要がありました。

## 困っていたこと

このメールサーバー運用でいくつか困っていたことがありました。

* 【切実】OSのサポート期限が迫っていたので、早く問題を解決したい
* 手動構築されたサーバーなので、OSアップデートのために再構築するのが手間
* Ansibleなどのプロビジョニングツールで書き直すのが手間
* Dovecot + Postfixの設定が難しい
* サーバーの運用コストが少しかかっていた

といろいろありました。新OSでサーバーを再構築して移設するのが順当なのですが、それなりに時間がかかることもあり、できればもう少し楽な方法を模索していました。
いろいろ調べていた所、メール専用のサービスがあることを知り、運用の手間を減らしてサービス開発に注力するため、今回はメール専用サービスに移設する方針としました。

## メール専用サービスに求める要件

要件をまとめると以下となりました。

- 必須
    - ドメインレジストラに依存せず利用可
        - 運用中のサービスドメインなので、気軽のドメインレジストラの変更は不可
    - お値段が安い
        - 現サーバーコストより低ければOK
    - メールアドレス・転送メールアドレスが各々10個程度作成可能
- 出来たら
    - Webメーラーが提供されている
    - Web UIが分かりやすい
    - お試し利用ができる

その条件で調べた結果、[さくらのメールボックス](https://www.sakura.ne.jp/mail/)、[ムームーメール](https://muumuu-mail.com/)、[お名前メール](https://www.onamae.com/service/mail/) の３つが候補としてあがり、検討した結果「さくらのメールボックス」を採用しました。

## さくらのメールボックスを選んだ理由

理由は以下の通りです。

1. 【重要】ドメインレジストラに依存せずに利用できる
    - ムームーメールはムームードメインで管理しているドメインでないと利用できない制限があり、今回の候補から外れました
    - お名前メールはお名前.com管理のドメインでなくとも利用できるとのことでしたが、MXレコードに設定すべきホスト名が非公開かつ非推奨の利用方法とのことでしたので、候補から外しました
2. 料金が安い
    - 料金は初期費用無料で「年間一括 1,048円」と格安！
3. お試し利用ができる
    - 候補の中でさくらのメールボックスが唯一お試し利用ができました。契約時にクレジットカード決済がありますが、２週間以内にキャンセルすれば返金されます。

## 移設手順

1. さくらのメールボックスを契約する
    - 初期ドメインのホスト名が作成される
    - ![](/images/blog/2020/2020-03-22-01.png)
2.  さくらのメールボックスで環境構築
    1. 独自ドメイン(例: your-domain.jp）を登録する
    2. メールアドレス、転送メールアドレス設定をする
3. 各自のメーラーでさくらのメールボックスで作成したメールアドレスを設定
4. DNSでTTLを300秒など短くする
    - これは万が一トラブルが発生した際に、すぐに戻せるようにするため
5. DNSで独自ドメイン(例: your-domain.jp）のMXレコードをさくらのメールボックスで作成された初期ドメイン名（例: your-domain.sakura.ne.jp )に変更する
6. 独自ドメインのメールアドレス、転送メールアドレスでメールの送受信が可能か確認する
7. 終わり

## おわりに

目的は無事に達成できました。作業自体も簡単で特に大きな問題はありませんでした。これで今後の運用も楽になります。メールサーバーの構築は難易度が高く再構築も難しいので、メールアドレス管理はさくらのメールボックスのようなメール専用サービスに任せてしまうのも有りだと思いました。

## 参考情報

- [さくらのメールボックス](https://www.sakura.ne.jp/mail/)
- [メール – さくらのサポート情報](https://help.sakura.ad.jp/category/rs/rs_mail/?_ga=2.5386224.2109349385.1584797086-367465202.1584164950)
- [月間約1,000万PVのサイトをサーバー移設した話 \| hypermkt blog](https://blog.hypermkt.jp/2015/2015-11-29-server-relocated-for-ten-million-pv-site/)